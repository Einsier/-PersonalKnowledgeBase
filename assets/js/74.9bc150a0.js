(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{419:function(s,a,t){"use strict";t.r(a);var e=t(21),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"安装步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[s._v("#")]),s._v(" 安装步骤")]),s._v(" "),t("p",[s._v("操作环境：")]),s._v(" "),t("ul",[t("li",[s._v("Linux系统：Ubuntu 18.04")]),s._v(" "),t("li",[s._v("原内核：5.4.0-91-generic")]),s._v(" "),t("li",[s._v("新内核：5.4.22")])]),s._v(" "),t("h3",{attrs:{id:"查看本机内核版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看本机内核版本"}},[s._v("#")]),s._v(" 查看本机内核版本")]),s._v(" "),t("p",[s._v("在终端内输入"),t("code",[s._v("uname -r")]),s._v("可查看本机内核版本")]),s._v(" "),t("h3",{attrs:{id:"下载内核源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载内核源码"}},[s._v("#")]),s._v(" 下载内核源码")]),s._v(" "),t("p",[s._v("可在"),t("a",{attrs:{href:"https://mirrors.edge.kernel.org/pub/linux/kernel",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://mirrors.edge.kernel.org/pub/linux/kernel/"),t("OutboundLink")],1),s._v("中下载各版本的内核源码，将其解压至目录"),t("code",[s._v("/usr/src")]),s._v("中：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf linux-5.4.22.tar.gz -C /usr/src\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"安装必要软件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装必要软件"}},[s._v("#")]),s._v(" 安装必要软件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" fakeroot build-essential ncurses-dev xz-utils libssl-dev "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bc")]),s._v(" flex libelf-dev bison\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"内核配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内核配置"}},[s._v("#")]),s._v(" 内核配置")]),s._v(" "),t("p",[s._v("因为两个版本相近，拷贝与本机相同的配置文件：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/src/linux-5.4.22  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入内核源码目录")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" mrproper  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若此前编译过，使用该命令清理编译的残留文件（包括配置文件和中间文件）；否则跳过")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -v /boot/config-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -r"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" .config  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝当前使用的配置文件至本目录下")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("使用命令"),t("code",[s._v("sodu vim .config")]),s._v("修改配置，图中所示参数置为空：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/einsier/pics-bed/raw/master/pics/20211203211857.png",alt:"image-20211203200752258"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" menuconfig  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开图形化配置界面，可进行修改操作；这里不做更改，直接保存退出")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://gitee.com/einsier/pics-bed/raw/master/pics/20211203211905.png",alt:"image-20211203090017205"}})]),s._v(" "),t("h3",{attrs:{id:"编译内核"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译内核"}},[s._v("#")]),s._v(" 编译内核")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("/usr/src/linux-5.4.22")]),s._v("目录下执行：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" clean  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若此前编译过，清除中间文件（保留配置文件）")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -j4 bzImage  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译内核，-j<number>：以多线程数并行编译")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("此过程较漫长，若编译成功，可在"),t("code",[s._v("./arch/x86/boot/")]),s._v("目录（根据终端信息可能有所不同）下找到"),t("code",[s._v("bzImage")])]),s._v(" "),t("h3",{attrs:{id:"编译安装驱动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译安装驱动"}},[s._v("#")]),s._v(" 编译安装驱动")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("/usr/src/linux-5.4.22")]),s._v("目录下执行：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -j4 modules  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建所有驱动")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -j4 modules_install "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装驱动")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("此过程较漫长，若安装成功，可在"),t("code",[s._v("/lib/modules/")]),s._v("目录下新生成一个"),t("code",[s._v("5.4.22")]),s._v("目录")]),s._v(" "),t("h3",{attrs:{id:"安装内核"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装内核"}},[s._v("#")]),s._v(" 安装内核")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("/usr/src/linux-5.4.22")]),s._v("目录下执行：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -j4 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装新内核")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("若安装成功，查看"),t("code",[s._v("/boot")]),s._v("目录，将会生成"),t("code",[s._v("initrd.img-5.4.22")]),s._v("、"),t("code",[s._v("System.map-5.4.22")]),s._v("、"),t("code",[s._v("vmlinuz-5.4.22")]),s._v("三个文件，且"),t("code",[s._v("/boot/grub/grub.cfg")]),s._v("中也会更新新内核的相关信息")]),s._v(" "),t("h3",{attrs:{id:"修改grub配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改grub配置"}},[s._v("#")]),s._v(" 修改grub配置")]),s._v(" "),t("p",[s._v("执行命令"),t("code",[s._v("sudo vim /etc/default/grub")]),s._v("修改"),t("code",[s._v("grub")]),s._v("配置，修改图中所示参数：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/einsier/pics-bed/raw/master/pics/20211203211947.png",alt:"image-20211203193449907"}})]),s._v(" "),t("p",[s._v("执行以下命令更新"),t("code",[s._v("grub")]),s._v("配置使得启动时可选择内核版本：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("update-grub")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"验证结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证结果"}},[s._v("#")]),s._v(" 验证结果")]),s._v(" "),t("p",[s._v("重启系统，选择新内核启动：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/einsier/pics-bed/raw/master/pics/20211203212527.png",alt:"image-20211203195354005"}})]),s._v(" "),t("p",[s._v("可使用命令"),t("code",[s._v("uname -r")]),s._v("查看系统内核版本是否已经更改")]),s._v(" "),t("h2",{attrs:{id:"问题及解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题及解决"}},[s._v("#")]),s._v(" 问题及解决")]),s._v(" "),t("ol",[t("li",[s._v("无法启动"),t("code",[s._v("menuconfig")]),s._v("：需要安装必要软件和依赖，过程参见"),t("a",{attrs:{href:"#%E5%AE%89%E8%A3%85%E5%BF%85%E8%A6%81%E8%BD%AF%E4%BB%B6"}},[s._v("步骤-安装必要软件")])]),s._v(" "),t("li",[s._v("编译时报错"),t("code",[s._v("No rule to make target 'debian/canonical-certs.pem', needed by 'certs/x509_certificate_list'")]),s._v("：将"),t("code",[s._v(".config")]),s._v("中"),t("code",[s._v("CONFIG_SYSTEM_TRUSTED_KEYS")]),s._v("置空，过程参见"),t("a",{attrs:{href:"#%E5%86%85%E6%A0%B8%E9%85%8D%E7%BD%AE"}},[s._v("步骤-内核配置")])]),s._v(" "),t("li",[s._v("编译过程中磁盘空间不够，使用"),t("code",[s._v("Gparted")]),s._v("工具进行扩容，在此不做过多介绍")])])])}),[],!1,null,null,null);a.default=n.exports}}]);